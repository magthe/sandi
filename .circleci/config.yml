version: 2

jobs:
  build:
    docker:
      - image: nixorg/nix:circleci
        environment:
          NIXPKGS_ALLOW_UNFREE: 1

    working_directory: ~/repo

    steps:
      - checkout
      - run:
          name: Set up Nix
          command: |
            nix-channel --add https://nixos.org/channels/nixpkgs-unstable
            nix-channel --update
            nix-channel --list
      - run:
          name: Build sandi
          command: |
            nix-build --attr sandi

      - run:
          name: Build omnicodec
          command: |
            nix-build --attr omnicodec
